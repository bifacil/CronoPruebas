

<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Declaring the Grain</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description">
		<meta name="application-name">
		<meta name="title">
		<link href="../../../favicon.ico" rel="shortcut icon" />
		<link rel="stylesheet" href="../../../resources/main.css">
	</head>
	

	<body>
	
		<div class="jumbotron1" id="jumbotron1">
			<div class="container">
				<h1 class="article-header">Declaring the Grain</h1>
				<div class="article-date">s&#225;bado, 1 de marzo de 2003</div>
			</div>
		</div>
	
		<hr id="anchor-point"/>
		<div class="container-fluid">
			<a href="../../../archive/bi/dwh/declaring-the-grain.html#" class="navigationBars">
				<div class="iconBars closed">
					<span id="icon-bar1" class="iconBar colorChange background"></span>
					<span id="icon-bar2" class="iconBar colorChange background"></span>
					<span id="icon-bar3" class="iconBar colorChange background"></span>
				</div>
			</a>
			<div class="navLinks">
				<a id="link1" class="colorChange navLink link1" href="../../../index.html">Home</a>
				<a class="iconLink" href="../../../index.html"><i title="Home" id="icon1" class="fa fa-home colorChange link1"></i></a>
	
				<a id="link2" class="colorChange navLink link2" href="../../../about.html">Sobre mi</a>
				<a class="iconLink" href="../../../about.html"><i title="Sobre mi" id="icon2" class="fa fa-envelope colorChange link2"></i></a>

				<a id="link2" class="colorChange navLink link3" href="../../../archive.html">Archivo</a>
				<a class="iconLink" href="../../../about.html"><i title="Archivo" id="icon3" class="fa fa-archive colorChange link3"></i></a>
			</div>			
			
			<div class="row">
				<div class="content col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1">
					<div class="article">
						<p class="article-description"></p>				
						<div class="article-content">
							<div class="pf-content">
							<p>In debugging literally thousands of dimensional designs from my students over the years, I have found that the most frequent design error by far is not declaring the grain of the fact table at the beginning of the design process. If the grain isn&#8217;t clearly defined, the whole design rests on quicksand. Discussions about candidate dimensions go around in circles, and rogue facts that introduce application errors sneak into the design.</p>
							<p>Declaring the grain means sayingÂ <em>exactly</em>Â what a fact table record represents. Remember that a fact table record captures a measurement. Example declarations of the grain include:</p>
							<ul>
							<li>An individual line item on a customer&#8217;s retail sales ticket as measured by a scanner device</li>
							<li>An individual transaction against an insurance policy</li>
							<li>A line item on a bill received from a doctor</li>
							<li>A boarding pass used by someone on an airplane flight</li>
							<li>An inventory measurement taken every week for every product in every store.</li>
							</ul>
							<h4>In Business Terms</h4>
							<p>Notice that most of these grain declarations are expressed in business terms. Perhaps you were expecting the grain to be a traditional declaration of the fact table&#8217;s primary key. Although the grain ultimately is equivalent to the primary key, it&#8217;s a mistake to list a set of dimensions and then assume that this list is the grain declaration. This is the most common mistake in my students&#8217; designs. In a properly executed dimensional design, the grain is first anchored to a clear business object (no pun intended) and a set of business rules. Then, the dimensions that implement that grain become obvious.</p>
							<p>So, when you make a grain declaration, you can then have a very precise discussion of which dimensions are possible and which are not. For example, a line item of a doctor&#8217;s bill likely would have the following dimensions:</p>
							<ul>
							<li>Date (of treatment)</li>
							<li>Doctor (may be called &#8220;provider&#8221;)</li>
							<li>Patient</li>
							<li>Procedure</li>
							<li>Primary Diagnosis</li>
							<li>Location (presumably the doctor&#8217;s office)</li>
							<li>Billing Organization (an organization the doctor belongs to)</li>
							<li>Responsible Party (either the patient or the patient&#8217;s legal guardian)</li>
							<li>Primary Payer (often an insurance plan)</li>
							<li>Secondary Payer (maybe the responsible party&#8217;s spouse&#8217;s insurance plan).</li>
							</ul>
							<p>And quite possibly others.</p>
							<h4>Powerful Effects</h4>
							<p>If you&#8217;ve been following this example, I hope you&#8217;ve noticed some powerful effects from declaring the grain. First, you can visualize the dimensionality of the doctor bill line item very precisely, and you can therefore confidently examine your data sources, deciding whether or not a dimension can be attached to this data. For example, you probably would exclude &#8220;treatment outcome&#8221; from this example because most medical billing data doesn&#8217;t tie to any notion of outcome.</p>
							<p>But a general entity/relation-oriented &#8220;data model&#8221; of doctor visits might well include treatment outcome. After all, in an abstract sense, doesn&#8217;t every treatment have an outcome?</p>
							<p>The discipline of insisting on the grain declaration at the beginning of a dimensional design keeps you from making this kind of mistake. A model of billable doctor visits that included treatment outcome would look like a dimensional model but it wouldn&#8217;t be implementable. This is my main gripe with many of the current offerings of &#8220;standard schemas&#8221; in books and CDs. Because they have no grain discipline, they often combine entities that don&#8217;t coexist in real data sources. Every fact table design must be rooted in the realities of available physical data sources.</p>
							<p>A second major insight from the doctor bill line item grain declaration is that this very atomic grain gives rise to many dimensions! I listed 10 dimensions, and experts in health care billing probably know of a few more. It&#8217;s an interesting realization that the smaller and more atomic the measurement (fact table record), the more things you know for sure, and the more dimensions you have. This phenomenon is another way of explaining why atomic data resists the ad hoc attack by end users. Atomic data has the most dimensionality and so it can be constrained and rolled up in every way possible for that data source. Atomic data is a perfect match for the dimensional approach.</p>
							<p>In the doctor bill line item example with 10 dimensions, you wouldn&#8217;t expect the primary key of the fact table to consist of all 10 dimensional foreign keys. Logically from a business rules perspective, perhaps we know that the combination of date, doctor, patient, and procedure are enough to guarantee a unique record. So these fields could implement the fact table primary key. Or, it is possible that we have extra &#8220;degenerate&#8221; keys for the patient bill number and the line item number that would, by themselves, implement an acceptable physical fact table key. But we are confident that we can add these degenerate dimensions to the design because they are consistent with our grain declaration. The grain declaration is like a contract!</p>
							<p>The grain declaration lets us think creatively about adding dimensions to a fact table design that may not obviously be present in the source data. In retail sales data, marketplace causal factors like promotions and competitive effects may be very important to understanding the data, but this information may not be present in a literal sense in the data extract. The grain definition (see the first example in our list of grains) tells us that we can indeed add a causal &#8220;store condition&#8221; dimension to the fact table as long the store condition descriptions vary appropriately by time, product, and store location. A weather dimension can be added to many fact table designs using the same logic. Once such a new dimension is identified, it is incumbent on the data warehouse designer to find the appropriate store condition or weather data source and insert it into the backroom data staging applications that build the fact tables.</p>
							<p>All of the grain declarations listed in this article represent the lowest possible granularity of their respective data sources. These data measurements are &#8220;atomic&#8221; and cannot be divided further. But it is quite possible to declare higher level grains for each of these data sources that represent aggregations of atomic data:</p>
							<ul>
							<li>All the sales for a product in a store on a day</li>
							<li>Insurance policy transaction totals by month by line of business</li>
							<li>Charged amount totals by treatment by diagnosis by month</li>
							<li>Counts of passengers and other flight customer-satisfaction issues by route by month</li>
							<li>Average inventory levels by quarter by region.</li>
							</ul>
							<p>These higher levels of aggregation will usually have fewer, smaller dimensions. The doctor example might end up with only the dimensions:</p>
							<ul>
							<li>Month</li>
							<li>Doctor</li>
							<li>Procedure</li>
							<li>Diagnosis.</li>
							</ul>
							<p>It would be nonsensical in an aggregated fact table to try to include all the original dimensions of the atomic data, because you would find yourself recapitulating the atomic level of the data!</p>
							<p>Useful aggregations necessarily shrink dimensions and remove dimensions; therefore, aggregated data always needs to be used in conjunction with its base atomic data because aggregated data has less dimensional detail. Some developers get confused on this point, and after declaring that data marts necessarily consist of aggregated data, they criticize the data marts for &#8220;anticipating the business question.&#8221; All these misunderstandings disappear when aggregated data is made available along with the atomic data from which it&#8217;s derived.</p>
							<h4>Keep Facts True to the Grain</h4>
							<p>The most important result of declaring the grain of the fact table is anchoring the discussion of the dimensions. But declaring the grain lets you be equally clear about the measured numeric facts. Simply put, the facts must be true to the grain. In the doctor example, the most obvious measured fact would be &#8220;billed amount,&#8221; relating to the specific line item.</p>
							<p>Other facts relating to the treatment that patient received at that time may also exist. But helpful facts, such as the amount billed year-to-date to this patient for all treatments, aren&#8217;t true to the grain. When a reporting application combines fact records arbitrarily, these untrue-to-the-grain facts produce nonsensical, useless results. Viewed in this way, these facts are dangerous because they invite the end user to make mistakes. Omit them from the design. Calculate such aggregate measures in your application.</p>
							<h4>Brief Recap</h4>
							<p>In summary, try to do your dimensional designs using the following four steps, in order:</p>
							<p>1. Decide on your sources of data.</p>
							<p>2. Declare the grain of the fact table (preferably at the most atomic level).</p>
							<p>3. Add dimensions for &#8220;everything you know&#8221; about this grain.</p>
							<p>4. Add numeric measured facts true to the grain.</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script src="../../../resources/jquery.min.js"></script>
		<script src="../../../resources/menu.js"></script>
			
		
		<a id="scrollUp" href="../../../archive/bi/dwh/declaring-the-grain.html#top" title="Volver" style="position: fixed; z-index: 2147483647; display: none;">
			<i class="fa fa-chevron-up"></i>
		</a>
	</body>
</html>